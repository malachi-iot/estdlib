Code lifted directly from LLVM source

Attempts to act like 'raw' with the most minimal of dependencies, but the requirement to be
includable from `platform.h` is not present